(()=>{"use strict";class t{constructor(t,e,s,i,a,n,r){this._cardTemplate=e,this._handleImageClick=s,this._userId=i,this._like=a,this._dislike=n,this._deleteCard=r,this._likes=t.likes,this._id=t._id,this._name=t.name,this._link=t.link,this._ownerId=t.owner._id}like(){this._likeButton.classList.add("element__like_active")}dislike(){this._likeButton.classList.remove("element__like_active")}_userLiked(){this._likes.forEach((t=>{t._id===this._userId?this.like():this.dislike()}))}likesCount(t){this._likesCount.textContent=`${t.likes.length}`}remove(){this._card.remove(),this._card=null}_getTemplate(){return document.querySelector(this._cardTemplate).content.querySelector(".element").cloneNode(!0)}generateCard(){return this._card=this._getTemplate(),console.log(),this._likeButton=this._card.querySelector(".element__like"),this._likesCount=this._card.querySelector(".element__count-like"),this._likesCount.textContent=this._likes.length,this._deleteButtonTrash=this._card.querySelector(".element__delete"),this._ownerId!==this._userId&&this._deleteButtonTrash.remove(),this.elementImage=this._card.querySelector(".element__image"),this.elementImage.src=this._link,this.elementImage.alt=this._name,this._card.querySelector(".element__title").textContent=this._name,this._setEventListeners(),this._userLiked(),this._card}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._likeButton.classList.contains("element__like_active")?this._dislike():this._like()})),this._deleteButtonTrash.addEventListener("click",(()=>{this._deleteCard(this._id)})),this.elementImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)}))}}class e{constructor(t,e){this._form=e,this._config=t,this._buttonSave=this._form.querySelector(this._config.submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector))}enableValidation(){this._setEventListeners()}disableSubmitButton(){this._buttonSave.classList.remove(this._config.activeButtonClass),this._buttonSave.classList.add(this._config.inactiveButtonClass),this._buttonSave.disabled=!0}enableSubmitButton(){this._buttonSave.classList.add(this._config.activeButtonClass),this._buttonSave.classList.remove(this._config.inactiveButtonClass),this._buttonSave.disabled=!1}_showInputError(t){const e=this._form.querySelector(`.${t.id}-error`);e.classList.add(this._config.errorClass),e.textContent=t.validationMessage,t.classList.add(this._config.inputErrorClass)}_hideInputError(t){const e=this._form.querySelector(`.${t.id}-error`);e.classList.remove(this._config.errorClass),e.textContent="",t.classList.remove(this._config.inputErrorClass)}_checkInputValidity(t){t.validity.valid?this._hideInputError(t):this._showInputError(t)}_hasInvalidInput(){return this._inputList.some((t=>!t.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?this.disableSubmitButton():this.enableSubmitButton()}_setEventListeners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))}}class s{constructor(t){this._popup=document.querySelector(t),this._buttonClose=this._popup.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this),this._handleCloseByOverlay=this._handleCloseByOverlay.bind(this)}open(){this.setEventListeners(),document.addEventListener("keydown",this._handleEscClose),this._popup.classList.add("popup_opened")}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(t){"Escape"===t.key&&this.close()}_handleCloseByOverlay(t){t.target.classList.contains("popup_opened")&&this.close()}setEventListeners(){this._popup.addEventListener("mouseup",this._handleCloseByOverlay),this._buttonClose.addEventListener("click",(()=>{this.close()}))}}class i extends s{constructor(t,e){super(t),this._callbackSubmit=e,this._form=this._popup.querySelector(".popup__form"),this._inputs=[...this._form.querySelectorAll(".popup__input")],this._form.addEventListener("submit",(t=>{t.preventDefault();const e=t.submitter.textContent;t.submitter.textContent="Сохранение...",this._callbackSubmit(this._getInputValues()).then((()=>this.close())).finally((()=>{t.submitter.textContent=e}))}))}_getInputValues(){const t={};return this._inputs.forEach((e=>{t[e.name]=e.value})),t}setInputValue(t){this._inputs.forEach((e=>{e.value=t[e.name]}))}close(){super.close(),this._form.reset()}}const a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_type_disabled",activeButtonClass:"popup__button_valid",inputErrorClass:"popup__input-error_type_active",errorClass:"error"},n=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__edit-button-avatar"),l=document.querySelector(".profile__title"),h=document.querySelector(".profile__text"),c=document.querySelector(".profile__avatar"),_=document.forms.formProfile,d=document.forms.formAddCard,u=document.forms.editAvatar;let p;function m(e){const s=new t(e,"#templateCards",v,p,(async()=>{try{const t=await q.putLike(e._id);s.like(),s.likesCount(t)}catch(t){return console.log(`Ошибка: ${t}`)}}),(async()=>{try{const t=await q.deleteLike(e._id);s.dislike(),s.likesCount(t)}catch(t){return console.log(`Ошибка: ${t}`)}}),(()=>{g.open(s)}));return s.generateCard()}function v(t,e){f.open(t,e)}const f=new class extends s{constructor(t){super(t),this._imagePopup=this._popup.querySelector(".popup__card-image"),this._imagePopupTitle=this._popup.querySelector(".popup__card-title")}open(t,e){this._imagePopupTitle.textContent=t,this._imagePopup.src=e,this._imagePopup.alt="Изображение"+t,super.open()}}(".popup_type_big-card"),b=new i(".popup_type_add",(async function(t){try{const e=await q.createCard(t);S.addItem(m(e))}catch(t){return console.log(`Ошибка: ${t}`)}})),y=new i(".popup_type_edit",(async function(t){try{const e=await q.editProfileUser(t);C.setUserInfo(e)}catch(t){return console.log(`Ошибка: ${t}`)}})),k=new i(".popup_type_edit-avatar",(async function(t){try{const e=await q.editProfileAvatar(t);C.setUserInfo(e)}catch(t){return console.log(`Ошибка: ${t}`)}})),C=new class{constructor({name:t,about:e,avatar:s}){this._data={name:t.textContent,about:e.textContent,avatar:s.textContent},this._name=t,this._about=e,this._avatar=s}getUserInfo(){return{name:this._data.name,about:this._data.about,avatar:this._data.avatar}}setUserInfo(t){this._data.name=t.name,this._data.about=t.about,this._data.avatar=t.avatar,t.name&&(this._name.textContent=this._data.name),t.about&&(this._about.textContent=this._data.about),t.avatar&&(this._avatar.src=this._data.avatar,this._avatar.alt=this._data.name)}}({name:l,about:h,avatar:c}),g=new class extends s{constructor(t,e){super(t),this._handleSubmit=e,this._popupForm=this._popup.querySelector(".popup__form"),this._popupForm.addEventListener("submit",(t=>{t.preventDefault(),this._handleSubmit(this._card)}))}open(t){this._card=t,super.open()}}(".popup_type_delete",(async t=>{q.deleteCard(t._id).then((()=>{t.remove(),g.close()})).catch((t=>console.log(`Ошибка: ${t}`)))})),S=new class{constructor({renderer:t},e){this._renderer=t,this._container=document.querySelector(e)}addItem=t=>{this._container.prepend(t)};renderItems(t){t.reverse().forEach((t=>this._renderer(t)))}}({renderer:t=>{const e=m(t);S.addItem(e)}},".elements");n.addEventListener("click",(()=>{y.open(),y.setInputValue(C.getUserInfo()),L.disableSubmitButton()}),!1),o.addEventListener("click",(()=>{k.open(),I.disableSubmitButton()}),!1),r.addEventListener("click",(()=>{b.open(),E.disableSubmitButton()}),!1);const L=new e(a,_);L.enableValidation();const E=new e(a,d);E.enableValidation();const I=new e(a,u);I.enableValidation();const q=new class{constructor(t){this._baseUrl=t.baseUrl,this._headers=t.headers}_handleTransferReq(t){return t.ok?Promise.resolve(t.json()):Promise.reject(`Ошибка: ${t.status}`)}async getUserInfo(){const t=await fetch(`${this._baseUrl}/users/me`,{headers:this._headers});return this._handleTransferReq(t)}async getCards(){const t=await fetch(`${this._baseUrl}/cards`,{headers:this._headers});return this._handleTransferReq(t)}async editProfileUser(t){const e=await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t.name,about:t.about})});return this._handleTransferReq(e)}async createCard(t){const e=await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(t)});return this._handleTransferReq(e)}async putLike(t){const e=await fetch(`${this._baseUrl}/cards/${t}/likes`,{method:"PUT",headers:this._headers});return this._handleTransferReq(e)}async deleteCard(t){const e=await fetch(`${this._baseUrl}/cards/${t}`,{method:"DELETE",headers:this._headers});return this._handleTransferReq(e)}async deleteLike(t){const e=await fetch(`${this._baseUrl}/cards/${t}/likes`,{method:"DELETE",headers:this._headers});return this._handleTransferReq(e)}async editProfileAvatar(t){const e=await fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t.avatar})});return this._handleTransferReq(e)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-65",headers:{authorization:"3214d118-6e50-4726-ad0d-555baedd0477","Content-Type":"application/json"}});Promise.all([q.getUserInfo(),q.getCards()]).then((([t,e])=>{C.setUserInfo(t),p=t._id,S.renderItems(e)})).catch((t=>console.log(`Ошибка: ${t}`)))})();